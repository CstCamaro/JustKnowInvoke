<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>北部新区停车熄火倡议</title>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<link rel="stylesheet" type="text/css" href="http://cq.qq.com/wish/main.css" />
<link rel="stylesheet" type="text/css" href="//cq.qq.com/css/cody/2013/xyq.css">
<script type="text/javascript" src="//cq.qq.com/js/cody/wishwall/j.tips.js"></script>
<script language="javascript" src="//cq.qq.com/js/common/jquery.min.1.4.2.js"></script>
<script type="text/javascript" src="//cq.qq.com/js/common/trimpath-template-1.0.38.js"></script>
<script type="text/javascript" src="http://ud.cq.qq.com/statics/js/activity_demo.js?v=201304161601"charset="utf-8"></script>
  <script type="text/javascript">
  //var reg_host = site_domain;
  var img_num = '0';
  var activity_id = '737';
</script>
<style>
#stat_xyq {width:960px; margin:0 auto;height:50px;background-color:#7ac300;padding-top:6px;}
#stat_xyq .fl {color:#fff;font-size:18px;line-height:40px;}
#coun_p {color:#d7e900;}
#main_xyq {width:960px;margin:0 auto;height:620px;}
#contentarea {position:relative;}
#pager {position:static;}
#marsk_con {padding:20px;background-color:#fff;border:1px solid #dedede;}
#contentarea .box .sbody {background-position: -2px 0;}
</style>
</head>
<body>

<script type="text/javascript" src="http://ud.cq.qq.com/api/activity/737/result/js?result=res"></script>
<div id="stat_xyq" class="clearfix">
	<div class="fl">当前倡议人数 <span id="coun_p"></span> 人</div>
	<div class="fr">
		<a href="javascript:;" id="show_xy"><img src="//mat1.gtimg.com/cq/cody/2013/xyq/btn.png" width="127" height="44" /></a>
	</div>
</div>
<div id="main_xyq">
<div id="contentarea"></div>
</div>
<XMP id="feed_template" style="display:none;">
{for p in content_list}
<div id="wish${p.id}" class="scrip${p.tyle} box" style="z-index:${p.id};left: ${p.left}px; top:${p.top}px;" onmousedown="Tips.Mouse.down(this, event)">
<table border="0" cellpadding="0" cellspacing="0">
<tr><td>
<div class="shead" align="center"><p style="width: 150px; padding: 0px; margin: 0px; float: left; height: 18px;"></p><a style="cursor:pointer" onclick="HideWish('wish${p.id}')" title="关闭纸条">×</a>
</div>
</td></tr>
<tr><td>
<div class="sbody">${p.content}</div><div class="sbot"><h2>${p.name}</h2></div>
</td></tr>
</table></div>
{/for}
</XMP>
<div id="pager"></div>
<div id="marsk_xyq" style="display:none;;position:absolute;z-index:998;background-color:#000;left:0;top:0;"></div>
<div id="marsk_con" style="display:none;position:absolute;z-index:999;">
	<iframe id="areaud_post_async_iframe" name="areaud_post_async_iframe" frameborder="0" style="display:none;"></iframe>
	<div class="join_area">
		<form id="reg_form" method="post" action="" target="areaud_post_async_iframe" >
			<div id="my_images"></div>
			<div style="clear:both;"></div>
			<table>
				<tr>
					<td>姓名</td>
					<td><input type="text" name="field_3" id="field_3"/></td>
				</tr>
			</table>
			<table>
				<tr>
					<td>标签</td>
					<td>
						<ul id="bq_style">
							<li class="s1" rel="1"></li>
							<li class="s2" rel="2"></li>
							<li class="s3" rel="3"></li>
							<li class="s4" rel="4"></li>
							<li class="s5" rel="5"></li>
							<li class="s6" rel="6"></li>
							<li class="s7" rel="7"></li>
							<li class="s8" rel="8"></li>
						</ul>
						<input type="hidden" id="field_6" name="field_6" value="1"/>
					</td>
				</tr>
			</table>
			<table>
				<tr>
					<td>内容</td>
					<td><textarea name="field_8" id="field_8" style="width:250px;height:100px;"></textarea></td>
				</tr>
			</table>
		</form>
		<table>
			<tr>
				<td width="24"></td>
				<td><input id="reg_button" type="button" value="发布倡议"/></td>
			</tr>
		</table>
	</div>
</div>
<style>
#tmp_show {color: #8C4D00; position: absolute; width: 237px;z-index:999;display:none;}
#tmp_show .scrip4 .shead {
    background: url("//mat1.gtimg.com/cq/wish/images/a4_1.gif") repeat scroll 0 0 transparent;
    height: 18px;
    padding-left: 18px;
    padding-top: 50px;
}
#tmp_show .scrip4 .sbody {
    background: url("//mat1.gtimg.com/cq/wish/images/a4_2.gif") repeat scroll 0 0 transparent;
    line-height: 18px;
    overflow: hidden;
    padding: 20px 25px 20px 30px;
    text-align: left;
    width: 186px;
    word-wrap: break-word;
}
#tmp_show .scrip4 .sbot {
    background: url("//mat1.gtimg.com/cq/wish/images/a4_3.gif") repeat scroll 0 0 transparent;
    height: 47px;
    padding: 20px 20px 5px 30px;
    width: 186px;
}
#tmp_show .scrip4 .sbot h2 {
    float: right;
    margin-top: 7px;
}
</style>
<div id="tmp_show" onmousedown="Tips.Mouse.down(this, event)">
	<div  class="scrip4 box" id="wishtmp">
		<table cellspacing="0" cellpadding="0" border="0">
		<tbody>
			<tr>
			<td>
			<div align="center" class="shead"><p style="width: 150px; padding: 0px; margin: 0px; float: left; height: 18px;"></p><a title="关闭纸条" onclick="HideWish('wishtmp')" style="cursor:pointer">×</a></div>
			</td>
		</tr>
		<tr>
			<td>
				<div class="sbody" id="xyq_con"></div><div class="sbot"><h2 id="author"></h2></div>
			</td>
		</tr>
		</tbody>
		</table>
	</div>
</div>

<script language="JavaScript">
var index = 1000;
var l_w = 0;
var w_li = 235;
var h_li = 198;
var col_i = 0;
var f_x = 50;
var f_y = 5;
var tmp_i = 0;
function getFocus(obj)
{
    if(obj.style.zIndex != index){
        index += 2;
        obj.style.zIndex = index;
    }
}
function HideWish(ObjectID)
{
    $("#"+ObjectID).remove();
}

var data = res.data;
var perpage = 12;
var countPage = Math.ceil(data.total_num / perpage);

var BodyWidth = document.body.clientWidth-260;
var BodyHeight = window.screen.height-500;
function  getLeft(i) {
	//return i%4==0 ? l_w=((i%4)*w_li) : l_w=((i%4)*w_li-Math.round(Math.random()*f_x));
	return (i%4)*w_li;
}

function  getTop(i){
    return col_i * h_li + Math.round(Math.random()*f_y);
}

function  pager(curPage){
    var data_new = [];

    curPage = curPage < 1 ? 1: (curPage > countPage? countPage : (curPage||1));
	col_i = 0;
	var temp_start = (curPage-1) * 12;
	var temp_end = 12;
    data_new['content_list'] = getArrPart(temp_start, temp_end);

    var result = TrimPath.processDOMTemplate("feed_template", data_new);
    document.getElementById("contentarea").innerHTML = result;

    $("#pager").html(page(curPage));
}

// pager
function page(curPage) {
    var pa = [];
    curPage = curPage < 1 ? 1: (curPage > countPage? countPage : (curPage||1));
    for(i=1; i<= countPage; i++){
        if(curPage == i){
            pa.push('&nbsp;<strong><a href="javascript:pager('+i+')">'+i+'</a><strong>');
        }else{
            pa.push('&nbsp;<a href="javascript:pager('+i+')">'+i+'</a>');
        }
    }
    return pa.join('');
}

function getArrPart(start, cnt) {
    start = start || 0;
    var newData = {};


    if(res.data.reg_data instanceof Array ){
        for(var i=0; i < cnt; i++){
            var tmp=[];
            if(! res.data.reg_data[start + i]){
                break;
            }
            //newData[i] = res.data.reg_data[start + i];
            tmp['id'] = start + i;
            tmp['left'] = getLeft(i);
            tmp['top'] = getTop(i);
            tmp['content'] = res.data.reg_data[start + i]['内容'];
            tmp['name'] = res.data.reg_data[start + i]['姓名'];
            tmp['tyle'] = res.data.reg_data[start + i]['标签'];
            newData[i] = tmp;
			tmp_i = i + 1;
			if(tmp_i%4 == 0){col_i++;}
        }
    }

    return newData;
}
pager(1);
</script>
<script>
  jQuery(document).ready(function(){

	var d_w = jQuery(window).width();
	var d_h = jQuery(window).height() + jQuery(window).scrollTop();
	var _left = (d_w - jQuery('#marsk_con').width()) / 2;
	var _top = (d_h - jQuery('#marsk_con').height()) / 2;
	var _tmp_left = (d_w - jQuery('#tmp_show').width()) / 2;
	var _tmp_top = ((jQuery(window).height() - jQuery('#tmp_show').height()) / 2) -50;

	jQuery('#marsk_xyq').css({'width': d_w+'px','height': d_h+'px','opacity':'0.5'});
	jQuery('#marsk_con').css({'left': _left+'px','top': _top+'px'});
	jQuery('#tmp_show').css({'left': _tmp_left+'px','top': _tmp_top+'px'});
	jQuery('#show_xy').click(function(){
		jQuery('#marsk_xyq').show();
		jQuery('#marsk_con').show();
	});
	jQuery('#marsk_xyq').click(function(){
		jQuery('#marsk_xyq').hide();
		jQuery('#marsk_con').hide();
	});
	jQuery('#coun_p').text(res['data']['total_num']);
	jQuery('#bq_style li').each(function(){
		jQuery(this).click(function(){
			jQuery('#field_6').val($(this).attr('rel'));
			$(this).addClass('selected').siblings().removeClass('selected');
		});
	});

	jQuery('#reg_button').click(function(){
		jQuery('#xyq_con').text(jQuery('#field_8').val());
		jQuery('#author').text(jQuery('#field_3').val());
		reg(737);
	});
  });
</script>
<script type="text/javascript">
function custom_reg_success()
{
	
	alert('提交成功，谢谢参与');
	jQuery('#marsk_xyq').hide();
	jQuery('#marsk_con').hide();
	jQuery('#tmp_show').show();
}
</script>
</body>
</html><!--[if !IE]>|xGv00|9f879f6bcca306cec66f39c8dc7fbc98<![endif]-->