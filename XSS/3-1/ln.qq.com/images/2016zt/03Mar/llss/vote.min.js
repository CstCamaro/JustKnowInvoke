/**
 * 
 * @authors WFE_jackiejiang (jackiejiang@tencent.com)
 * @modify TXdaliao_deanhuang (deanhuang@txdaliao.com) 
 * @date    2015-03-2 14:48:54
 */
 
$(function () {
    function addStyle(configCss) {
        if ((/msie (\d+)/i.test(navigator.userAgent) && !window.opera) ? parseInt(RegExp.jQuery1) : 0) {
            var t = document.createStyleSheet();
            t.cssText = configCss
        } else {
            var r = document.createElement("style");
            r.setAttribute("type", "text/css");
            document.getElementsByTagName('head')[0].appendChild(r);
            if (r.styleSheet) {
                r.styleSheet.cssText = configCss
            } else {
                r.appendChild(document.createTextNode(configCss))
            }
        }
    }
    if ($('#ui-voteBox').length > 0 && ztConfig.votePrjId != 0) {
        var voteCss;
        if (ztConfig.voteType) {
            voteCss = '#ui-voteBox {width:680px;  margin:0 auto;margin-bottom:35px; }' +
                '#ui-voteBox .hdCon {height: 65px;line-height: 54px;padding-top: 6px;text-align: center;font-family: "\5FAE\8F6F\96C5\9ED1";}' +
                '#ui-voteBox .hdCon *{ font-size: 18px;color: #333333;}' +
                '#ui-voteBoxui-voteBox .bd{ padding-left:22px;}' +
                '#ui-voteBox .voteList div.digg{line-height:200px; text-align:center; color:#666; width: 165px;height: 56px;text-indent: -999em;float:left; background:url(//mat1.gtimg.com/ent/guiquan/gqnew/bg_tp.png) 0 0 no-repeat;overflow: hidden;}' +
                '#ui-voteBox .voteList div.count{text-align: center;color: #dd3326;font-weight: bold;height: 40px;line-height: 40px;font-size: 14px; display:block;}' +
                '#ui-voteBox .voteList ul{width:100%;overflow:hidden}' +
                '#ui-voteBox .voteList li{float: left;width: 165px;margin:0 15px 0 20px; display:inline;cursor:pointer;}' +
                '#ui-voteBox .voteList li.vote_1 div.digg{background-position: -203px 0}' +
                '#ui-voteBox .voteList li.vote_2 div.digg{background: url(//mat1.gtimg.com/ent/guiquan/gqnew/bg_tp.png) -405px 0 no-repeat;}' +
                '#ui-voteBox .voteList li.vote_0 div.digg:hover{background-position: 0 -56px;}' +
                '#ui-voteBox .voteList li.vote_1 div.digg:hover{background-position: -203px -56px;}' +
                '#ui-voteBox .voteList li.vote_2 div.digg:hover{background-position: -405px -56px;}'
        } else {
            var optionColor1 = ztConfig.optionColor1 || '#e2a55c';
            var optionColor2 = ztConfig.optionColor2 || '#8baad0';
            voteCss = '.ztpj{height:120px;}.voteBox{position: relative;z-index: 10;zoom: 1;height:140px;}' +
                '.voteBox h3.voteTit{display:none;font-size:24px;font-family:"\5FAE\8F6F\96C5\9ED1";font-weight:100;height:40px;line-height:40px;text-align:center;}' +
                '.voteBox .voteList{padding: 20px 0;overflow: hidden;zoom:1;text-align: center;}' +
                '.voteBox .voteList li{margin: 0 65px;display:inline-block;*zoom:1;*display:inline;width: 71px;height: 90px;border-radius: 5px;}' +
                '.voteBox .voteList li.yes{background:none;position:absolute;top:20px;left:30px;}' +
                '.voteBox .voteList li.no{background:none;position:absolute;top:20px;right:30px;}' +
                '.voteBox .voteList li .count{display:none;color:#fff;font-family:arial;font-size:18px;text-align:center;height:40px;line-height:40px;border-bottom: 1px dotted #fff;}' +
                '.voteBox .voteList li .digg a,.voteBox .voteList li .digg{display:block;color: #fff;text-decoration: none;border:none;width:71px;text-align:center;line-height:26px;color:#fff;font-size:22px;}' +
                '.voteBox .voteList li .digg{height:26px;padding-top:64px;color:#333;}'+
                '.voteBox .voteList li .digg a{height:26px;padding-top:64px;color:#333;position:absolute;width:100%;height:26px;top:0;left:0;cursor:pointer;}'+
                '.voteBox .voteList li.yes .digg{background:url(//mat1.gtimg.com/ln/images/2016zt/03Mar/llss/redHeart.png) 0 0 no-repeat;}'+
                '.voteBox .voteList li.no .digg{background:url(//mat1.gtimg.com/ln/images/2016zt/03Mar/llss/blueHeart.png) 0 0 no-repeat;}'+
                '.voteBox .voteList li .digg a{background:none;color:#333;}' +
                '.voteBox .voteDraw{zoom:1; line-height:15px; font-size:14px; color:#606060; width:610px;height:32px;margin:0 auto;position: relative;z-index: 1;}' +
                '.voteBox .voteDraw span{position: absolute;z-index: 1;line-height:32px;font-size:22px;}' +
                '.voteBox .voteDraw .voteNum_l{left: 140px;top: 40px;}' +
                '.voteBox .voteDraw .voteNum_r{right: 120px;top: 40px;}' +
                '.voteBox .voteDraw .voteLine{width:100%; background:url(//mat1.gtimg.com/ln/images/2016zt/03Mar/llss/voteline.png) 0 -32px no-repeat; height:32px; float:left;display:inline;margin-right:15px;}' +
                '.voteBox .voteDraw .voteLine div{height:32px; background:url(//mat1.gtimg.com/ln/images/2016zt/03Mar/llss/voteline.png) 0 0 no-repeat;}'
        }
        addStyle(voteCss);
        var voteHtml = '<div class="hdCon"><h3 class="voteTit" id="ui-voteTit"></h3></div>' +
            '<ul class="voteList" id="ui-voteList"></ul>' + '<div class="voteDraw" id="ui-voteDraw">' +
            '<span class="voteNum_l"></span>' + '<div class="voteLine">' + '<div></div>' + '</div>' +
            '<span class="voteNum_r"></span>' + '</div>';
        $('#ui-voteBox').addClass('voteBox').html(voteHtml);
        $.getScript('//mat1.gtimg.com/www/panshi/js/digg2.js', function () {
            $.getJSON('http://panshi.qq.com/vote/' + ztConfig.votePrjId + '?source=1&callback=?', function (data) {
                var data = data.data;
                var optionidArr = [];
                var subjectid;
                var title;
                var optId = {};
                $.each(data.vote, function (i, n) {
                    $("#ui-voteTit").text(n.title)
                });
                $.each(data.option, function (i, n) {
                    $.each(n, function (ii, nn) {
                        var className = ii % 2 == 0 ? 'yes' : 'no';
                        if (ztConfig.voteType) {
                            $("#ui-voteList").append('<li class="vote_' + ii +
                                '"><div class="count" id="apps_svy_opt_count_' + nn.voteid + '_' + ii + '">' + nn.score +
                                '</div><div class="digg" onclick="AppPlatform.Survey.Digg.digg(this, ' + nn.voteid +
                                ', ' + nn.subjectid + ', ' + nn.optionid + ');" id="apps_svy_opt_title_' + nn.voteid +
                                '_' + ii + '" donetext="' + nn.title + '">' + nn.title + '</div></li>')
                        } else {
                            $("#ui-voteList").append('<li class="' + className +
                                '"><div class="count" id="apps_svy_opt_count_' + nn.voteid + '_' + ii + '">' + nn.score +
                                '</div><div class="digg" id="apps_svy_opt_title_' + nn.voteid + '_' + ii +
                                '" donetext="' + nn.title + '">' + nn.title + '</div></li>')
                        }
                        optionidArr.push(nn.optionid);
                        subjectid = nn.subjectid
                    })
                });
                for (var i = 0; i < optionidArr.length; i++) {
                    $('#ui-voteDraw span').eq(i).text(Math.round(data.result[subjectid][optionidArr[i]].percent) + '%');
                    $('.voteLine div').css('width', Math.round(data.result[subjectid][optionidArr[0]].percent) + '%');
                    optId[optionidArr[i]] = i
                }
                if (ztConfig.voteType) {
                    $('#ui-voteDraw').remove()
                }
                AppPlatform.Survey.Digg.init({
                    PrjId: ztConfig.votePrjId,
                    SubjId: subjectid,
                    DiggMode: ztConfig.DiggMode,
                    ShowResult: 1,
                    OptIdObject: optId
                })
            });
        })
    }
    if (ztConfig.votePrjId == 0) {
        $('.xwlc').hide()
    }
})
 
/*  |xGv00|354e0229d3e5fe12d622c8b985c285a8 */