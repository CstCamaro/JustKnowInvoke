/*
 * @author <a href="mailto:staurenliu@tencent.com">stauren</a>
 * @revision 7715
 * @version 1.0
 */
(function(d){var c="PushLoader",a="1.0",b=d.__;b.register("fn-pushloader",a,["fn-base"],function(){var g=b.Lang,j=b.Table,f=b.Dom,i=b.log,h=b.config.doc,l=b.config.ua,k="pv_timeout",e="pv_none_match";if(!(c in b)){b[c]=b.Class.extend({version:a,defaultUrls:["http://push1.gtimg.cn/q=","http://push2.gtimg.cn/q=","http://push3.gtimg.cn/q="],_uCount:0,_startRand:g.rand(2),_sendDelay:30,_jobs:{},aIframes:[],ifrCtn:null,_createIfr:function(){var m=f.addEl({tag:"iframe",id:"du-push-ifr"+(this.aIframes.length)},this.ifrCtn);this.aIframes.push(m);return m},_getIframe:function(o){var m,n=this.aIframes;if(l.ie){if(!n[0]){this._createIfr()}m=n[0]}else{g.find(n,function(p){if(p.className==""){m=p;return true}});if(!m){m=this._createIfr()}}if(o||!m.src){m.src=this._getDummySrc()}m.className="active";return m},_getDummySrc:function(){return this.dummy+"?_u="+(new Date).valueOf()%100000+Math.random()},_purgeIframe:function(n,m){n.className="";if(m){if(n.contentWindow){n.contentWindow.__=null}n.src=this._getDummySrc()}},_getHandler:function(r,u,s){var t,v,n,w,p,q,m,o;if(!s.tr){return false}q=this;w=s.processors||[];v=false;n=[];this._waitingUpd[r]=n;m=g.clone(u);if(s.update){o={};g.e(s.update,function(x){o[x]=1})}else{o=true}p=w[0];w[0]=function(y,z,C,x){var A=j.process(p,y,z,C,x),B=C.parentNode;if(!B.id){B.id="du-pl~"+r+"~"+u[x]}return A};t=function(y,x){var z=[];if(!v){z=[];g.e(u,function(A){z.push(y[A])});j.fill(z,s.tr,w);v=true}else{m=m.sort(function(){return Math.random()>0.5});g.e(m,function(A){if(A in y){n.push([A,y[A]])}});if(q._toIdProcess===null){q._processWaiting(r,s.priceIdx,w,o)}}};return t},_processWaiting:function(p,w,x,o){var n,m,u,v,r,t,s,q;n=this._waitingUpd[p];u=this;t=n.length;s=[];this._toIdProcess=null;if(t){r=Math.floor(t/2);if(r<3){r=Math.min(3,t)}for(q=0;q<r;++q){m=n.shift();v=f.id("du-pl~"+p+"~"+m[0]);if(v){u._doUpdate(v,m[1],w,x,o);s.push(v)}}this._toIdProcess=d.setTimeout(function(){g.e(s,function(y){if(y){y.className=""}});v=null;s=null;u._processWaiting(p,w,x,o)},1000)}},_doUpdate:function(q,p,m,o,s){var n=f.$("td",q),p=p.split("~"),r;g.e(n,function(x,u){var w,t,v;if(s===true||u in s){w=parseFloat(g.stripTags(n[u].innerHTML));v=j.process(o[u],p,u,x);t=parseFloat(g.stripTags(v));if(!isNaN(t)&&t!==w){x.className="du-pl-changed"}else{if(x.className!=""){x.className=""}}if(u==m){if(w>t){r="du-pl-down";v+='<span class="du-pl-arr">\u2193</span>'}else{if(w<t){r="du-pl-up";v+='<span class="du-pl-arr">\u2191</span>'}else{r="du-pl-level"}}}x.innerHTML=v}x=null});q.className=r;n=null;q=null},setup:function(z){var u=0,v=l.webkit,y=this,s,n,A,p,B,q,x,r,o,t=0,w=this._sendDelay,m;z=z||{};B=z.keys;if(!g.isArray(B)){throw new Error("Wrong parameter: keys is undefined.");return}B=g.unique(B);x=++this._uCount;r=this._maxCount;q=g.isFunction(z.onData)?z.onData:this._getHandler(x,B,z);o=[true,{}];this._jobs[x]=o;if(!g.isFunction(q)){throw new Error("Wrong parameter: onData can't be determined.");return}n=this.bases[(this._startRand+x)%this.bases.length]+B.join(",")+"&m=push&r="+(new Date).valueOf()%100000+g.rand(10000);p=function(){var C;if(!x in y._jobs||!o[0]||u>=r){return}u++;if(v){C=s;s=null;delete o[1][C]}if(!s){s=y._getIframe();o[1][s]=1}b.toCall(function(){var D=s.contentWindow,E;if(!D||!D.__){A();return}E=+new Date;D.reqCount=u;idu=D.__;if(m){d.clearTimeout(m)}m=d.setTimeout(function(){if(s.contentWindow.reqCount===u){A(true)}},75000);idu.load(n,function(){var G={},F;if(!x in y._jobs||!o[0]){return}if(D[e]===1){D[e]=0;throw new Error("No data for:"+B.join(","))}else{if(D[k]===1){D[k]=0;A()}else{if(D.reqCount==u){if(new Date-E<1000){t++}else{t=0}if(t>=10){w=1000}else{w=y._sendDelay}g.e(B,function(H){F="pv_"+H;if(F in D&&D[F]!==null){G[H]=D[F];D[F]=null}});q(G,u);D=null;idu=null;G=null;A()}}}},{charset:"gbk"});C&&y._purgeIframe(C,true)},function(){return s.contentWindow&&!!s.contentWindow.__})};A=function(C){try{d.setTimeout(function(){p()},C?0:w)}catch(D){}};A(true);return x},stop:function(m){var n=this,o=this._jobs;if(m in o){o[m][0]=false;g.e(o[m][1],function(p){n._purgeIframe(p,true)});delete o[m]}},init:function(m){if(!this.ifrCtn){this.ifrCtn=f.addEl({css:"position:absolute;visibility:hidden;top:0;left:0;height:0;width:0;"},h.body)}this.dummy=m.dummyUrl;this.bases=m.baseUrls||this.defaultUrls;this._maxCount=m.max||3600*24*2;this._waitingUpd={};this._toIdProcess=null}})}})}(this));/*  |xGv00|3c3dde0d6c13d285a5a49efb4120e939 */